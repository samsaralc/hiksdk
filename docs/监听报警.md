5.14 监听报警
5.14.1 启动监听，接收设备主动上传的报警等信息 NET_DVR_StartListen_V30
函 数： LONG NET_DVR_StartListen_V30(char *sLocalIP, WORD wLocalPort, MSGCallBack DataCallback, void*
pUserData = NULL)
参 数： [in]sLocalIP
[in]wLocalPort
[in]DataCallback
[in]pUserData
PC 机本地 IP 地址，可以置为 NULL
PC 本地监听端口号。由用户设置，必须和设备端设置的一致
回调函数
用户数据
typedef void(CALLBACK *MSGCallBack)(LONG lCommand,NET_DVR_ALARMER*pAlarmer,char
*pAlarmInfo,DWORD dwBufLen,void*pUser)
[out]lCommand
[out]pAlarmer
[out]pAlarmInfo
[out]dwBufLen
[out]pUser
上传的消息类型，详见表 5.
报警设备信息
报警信息，详见表 5.
报警信息缓存大小
用户数据
表 5.73 报警信息类型
lCommand 宏定义 宏定义值 含义
COMM_ALARM_DEVICE 0x4004 CVR 设备报警信息上传，由于通道值大于 256 而扩展
COMM_ALARM_DEVICE_V40 0x4009 CVR 设备报警信息扩展(增加报警信息子结构)
COMM_ALARM_CVR 0x4005 CVR 外部报警信息上传
返回值： -1 表示失败，其他值作为 NET_DVR_CloseAlarmChan_V30 函数的句柄参数。接口返回失败请调用
114
设备网络 SDK 编程指南
NET_DVR_GetLastError 获取错误码，通过错误码判断出错原因。
说 明： 该接口中回调函数的第一个参数（lCommand）和第三个参数（pAlarmInfo）是密切关联的，其
关系见表 5.。
表 5.74 报警信息结构
消息类型 lCommand 上传内容 pAlarmInfo 对应的结构体
COMM_ALARM_DEVICE CVR 设备报警信息，由于通道值大于 256 而扩展 NET_DVR_ALARMINFO_DEV
COMM_ALARM_DEVICE_V40 CVR 设备报警信息扩展(增加报警信息子结构) NET_DVR_ALARMINFO_DEV_V40
COMM_ALARM_CVR CVR 外部报警信息 NET_DVR_CVR_ALARM
 SDK 最大能支持 512 路监听。
 要使 PC 能够收到设备主动发过来的报警等信息，必须将设备的网络配置中的“远程管理主机
地址”或者“远程报警主机地址”设置成 PC 机的 IP 地址（与接口中的 sLocalIP 参数一致），“远
程管理主机端口号”或者“远程报警主机端口号”设置成 PC 机的监听端口号（与接口中的
wLocalPort 参数一致）。
 该接口中的回调函数优先级高于其他回调函数，即设置了该接口中的回调函数，其他回调函
数将接收不到报警信息。
 返回目录
5.14.2 停止监听（支持多线程）NET_DVR_StopListen_V30
函 数： BOOL NET_DVR_StopListen_V30(LONG lListenHandle)
参 数： [in]lListenHandle 监听句柄，NET_DVR_StartListen_V30 的返回值
返回值： TRUE 表示成功，FALSE 表示失败。接口返回失败请调用 NET_DVR_GetLastError 获取错误码，通
过错误码判断出错原因。
